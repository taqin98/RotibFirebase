<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=5, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Rotibul Haddad</title>
    <meta name="description" content="Rotibul Haddad Ponpes Balekambang Jepara">
    <meta name="keywords" content="ponpes balekambang, balekambang jepara, bootstrap 4, mobile template, cordova, phonegap, mobile, html, responsive" />
    <link rel="icon" type="image/png" href="assets/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/icon/192x192.png">
    <link rel="preload" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&amp;display=swap" async>
    <link rel="stylesheet" href="assets/css/style.css" async>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" href="assets/css/helper.css" async>
    <link rel="manifest" href="manifest.json">
    <style type="text/css">
        .p-5px{padding:5px}.card .card-body{padding:5px;line-height:1.4em}.bg-white{background:#fff}
        body.dark-mode-active .appHeader.scrolled.bg-primary.is-active {
            background: #16417f !important;
        }
        .menu-active {
          background-color: #f1f2f5;
        }
        body.dark-mode-active .bg-primary {
            background: #16417f !important;
            color: #FFF;
        }
        body.dark-mode-active .profileBox {
            background: #16417f !important;
        }
        body.dark-mode-active .dark-mode-image {
            filter:invert(1);mix-blend-mode:screen
        }
        .dark-mode-image {
            filter:invert(1);mix-blend-mode:screen
        }
        .swiper-container {
            width: 100%;
            height: 100%;
        }
          #progress {
            position:relative;
            width:250px;
            height:20px;
            border:1px solid red;
          }

          #progress .progress-bar {
            background:blue;
            height:20px;
            width:0%;
            display:inline-block;
          }

          #progress .progress-text {
            position:absolute;
            z-index:2;
            right:0;
          }
    </style>
    <!-- Jquery -->
    <script src="assets/js/lib/jquery-3.4.1.min.js"></script>
    <!-- SwipperJs -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="assets/js/root.js"></script>
    <script src="assets/js/data/menu.js"></script>
    <script type="text/javascript">
      $(function(){
        $('#search').load('template/AppSearch.html')
        $('.appHeader').load('template/AppHeader.html')
        $('.appBottomMenu').load('template/AppBottomMenu.html')
        $('#sidebarPanel').load('template/AppSidebar.html')
        renderMenu(master_menu)
      })
    </script>
  </head>
  <body>
    <!-- <div id="loader">
      <div class="spinner-border text-primary" role="status"></div>
    </div> -->

    <div id="search" class="appHeader">
    </div>

    <div class="appHeader bg-primary scrolled is-active">
    </div>

    <div id="appCapsule">
      <div class="section mb-0 p-0">
        <div id="loaderContent" style="display: none;position: fixed; transform: translate(-50%, -50%);top: 50%;left: 50%;">
          <div class="spinner-border text-primary" role="status"></div>
        </div>
        <div class="card p-0" id="cardContent">
          <div class="card-body main-content p-0 d-flex justify-content-between align-items-end" id="bodyContent">


            <!-- Swiper -->
            <div dir="rtl" class="swiper-container ">
              <div class="swiper-wrapper">
              </div>
            </div>

          </div>
        </div>
      </div>
      <div id="toast-4" class="toast-box toast-top">
        <div class="in">
          <div class="text">
            Auto closing in 2 seconds.
          </div>
        </div>
      </div>


      <!-- app footer -->

      <!-- * app footer -->

    </div>

    <div class="appBottomMenu">
    </div>

    <div class="modal fade panelbox panelbox-left" id="sidebarPanel" tabindex="-1" role="dialog">
    </div>
    
    <!-- ///////////// Js Files ////////////////////  -->
    <!-- Bootstrap-->
    <script src="assets/js/lib/popper.min.js"></script>
    <script src="assets/js/lib/bootstrap.min.js"></script>
    <!-- Ionicons -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@5.0.0/dist/ionicons/ionicons.esm.js" async></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/ionicons@5.0.0/dist/ionicons/ionicons.js" async></script>
    <!-- Owl Carousel -->
    <script src="assets/js/plugins/owl-carousel/owl.carousel.min.js"></script>
    
    <!-- Main Js File -->
    <script src="assets/js/main.js"></script>
    <script src="assets/js/data/images.js" id="arr_rotib"></script>
    <script src="assets/js/data/images_asmaul.js" id="arr_asmaul"></script>
    <script type="text/javascript">
      window.addEventListener('load', function() {
        renderMenu(master_menu)

        currentURL  = (sPushState !== '') ? sPushState : new URL(document.location.href);
        getValue    = currentURL.searchParams.get("storage");
        getSlide    = currentURL.searchParams.get("slide");
        if (currentURL.href == 'http://127.0.0.1:8887/public/' ||
          currentURL.href == 'http://127.0.0.1:8887/public/#' ||
          currentURL.href == 'https://rotibulhaddad-ef924.web.app/' ||
          currentURL.href == 'https://rotibulhaddad-ef924.web.app'){
          getValue = 'pembukaan-v3'
        }
      
        $(document).ready(function(){
          if ($('.body-menu ul').length < 1) {
            console.log('menu tidak ke load')
            $('#__errMenu').css('visibility', 'visible')
          } else {
            $('#__errMenu').remove()
          }

          if (getSlide !== null) {
            swiperSlideTo(getSlide)
          }

          switch(getValue){
            case 'pembukaan-v3':
            check_cache(getValue, pembukaan)
            break;

            case 'images-v3':
            check_cache(getValue, images)
            break;

            case 'asmaul-v3':
            check_cache(getValue, asmaul_husna)
            break;

            case 'doa-v3':
            check_cache(getValue, doa)
            break;
          }
        })
      })
      
    </script>

    <script type="text/javascript">
      const loadFromInternet = (arrData) => {
        let data = '';
        for(var i in arrData){
          data += `<div class="swiper-slide dark-mode-image"><img class="dark-mode-image" src="${arrData[i]}" id="page-image" 
          data-id=""
          data-page="" alt="" width="100%" height="100%"></div>`;
        }
        $('.swiper-wrapper').html(data);
      }
      let newArrayCache = [], source_array = []
      async function check_cache(CacheName, arrData){
        await caches.open(CacheName).then(function(cache) {

          switch(CacheName){
            case 'pembukaan-v3':
            source_array = pembukaan
            break;

            case 'images-v3':
            source_array = images
            break;

            case 'asmaul-v3':
            source_array = asmaul_husna
            break;

            case 'doa-v3':
            source_array = doa
            break;
          }
          
          cache.keys().then(function(keyList) {
            newArrayCache = []

            console.log('keyList.length', keyList.length)
            let data = ''
            if(keyList.length > 0){
              for(var i = 0; i < keyList.length; i++){
                for (var j = 0; j < source_array.length; j++) {
                  if(keyList[i].url == source_array[j]){
                    // console.log(i,'Matches index-',j, source_array[j])
                    newArrayCache[j] = source_array[j]
                  } else {
                    // console.log(i,'UnMatches index-',j, source_array[j])
                    newArrayCache[j] = source_array[j]
                  }
                }

                // console.log(newArrayCache[i])
                  data += `<div class="swiper-slide dark-mode-image"><img src="${newArrayCache[i]}" id="page-image" 
                  data-id=""
                  data-page="" alt="" width="100%" height="100%" class="dark-mode-image"></div>`;
              }

              
              $('.swiper-wrapper').html(data);
              $('body').attr('data-status', 'memuat data dari CacheStorage');
            } else {
              loadFromInternet(arrData)
              asyncCall_download(CacheName, arrData)
              $('body').attr('data-status', 'memuat data dari internet');
            }

            console.log(`Jumlah Data di cache [${CacheName}]`, keyList.length)
          })
        })
      }

    </script>
    <script type="text/javascript">
      var startX, startY, moveX, moveY;
      function touchStart(e){
        startX = e.touches[0].clientX ;
        startY = e.touches[0].clientY ;
      }

      function touchMove(e){
        moveX = e.touches[0].clientX ;
        moveY = e.touches[0].clientY ;
      }
      function touchEnd(){
        if(startX+100 < moveX){
          console.log('right');
        }else if(startX-100 > moveX){
          console.log('left');
        }
        if(startY+100 < moveY){
          console.log('down');
        }else if(startY-100 > moveY){
          console.log('up');
        }
      }
    </script>
  </body>
</html>
